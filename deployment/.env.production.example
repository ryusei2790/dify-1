# ======================================
# Dify Production Environment Variables
# for GCP Compute Engine Deployment
# ======================================

# IMPORTANT: Copy this file to .env.production and fill in your values
# Never commit .env.production to version control

# ======================================
# Common Variables
# ======================================

# Your domain name (e.g., dify.example.com)
DOMAIN_NAME=your-domain.com

# Console API URL (use your domain with https)
CONSOLE_API_URL=https://your-domain.com

# Console Web URL (use your domain with https)
CONSOLE_WEB_URL=https://your-domain.com

# Service API URL (use your domain with https)
SERVICE_API_URL=https://your-domain.com

# Trigger external URL
TRIGGER_URL=https://your-domain.com

# WebApp API backend URL
APP_API_URL=https://your-domain.com

# WebApp URL
APP_WEB_URL=https://your-domain.com

# File preview or download URL prefix
FILES_URL=https://your-domain.com

# ======================================
# Security Configuration
# ======================================

# Secret key for session encryption
# IMPORTANT: Generate a secure random string (e.g., openssl rand -hex 32)
SECRET_KEY=CHANGE_THIS_TO_A_RANDOM_SECRET_KEY

# Initial admin password (optional, leave empty to set on first login)
INIT_PASSWORD=

# Database password
# IMPORTANT: Use a strong password
DB_PASSWORD=CHANGE_THIS_DATABASE_PASSWORD

# Redis password
# IMPORTANT: Use a strong password
REDIS_PASSWORD=CHANGE_THIS_REDIS_PASSWORD

# Weaviate API key
# IMPORTANT: Generate a secure random string
WEAVIATE_API_KEY=CHANGE_THIS_WEAVIATE_API_KEY

# ======================================
# Server Configuration
# ======================================

LOG_LEVEL=INFO
DEBUG=false
FLASK_DEBUG=false
DEPLOY_ENV=PRODUCTION

# ======================================
# Database Configuration (PostgreSQL)
# ======================================

DB_TYPE=postgresql
DB_USERNAME=postgres
DB_HOST=db_postgres
DB_PORT=5432
DB_DATABASE=dify

# PostgreSQL Performance Tuning
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_WORK_MEM=8MB
POSTGRES_MAINTENANCE_WORK_MEM=128MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

SQLALCHEMY_POOL_SIZE=50
SQLALCHEMY_MAX_OVERFLOW=20
SQLALCHEMY_POOL_RECYCLE=3600

# ======================================
# Redis Configuration
# ======================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_USE_SSL=false

# Celery broker URL (will use Redis password from REDIS_PASSWORD)
CELERY_BROKER_URL=redis://:CHANGE_THIS_REDIS_PASSWORD@redis:6379/1

# ======================================
# Celery Worker Configuration
# ======================================

SERVER_WORKER_AMOUNT=2
CELERY_WORKER_AMOUNT=2

# ======================================
# Vector Database Configuration
# ======================================

VECTOR_STORE=weaviate
WEAVIATE_ENDPOINT=http://weaviate:8080
WEAVIATE_GRPC_ENDPOINT=grpc://weaviate:50051

# ======================================
# Storage Configuration
# ======================================

# Local storage (default for self-hosted)
STORAGE_TYPE=opendal
OPENDAL_SCHEME=fs
OPENDAL_FS_ROOT=storage

# For production, consider using cloud storage:
# S3, Azure Blob, Google Cloud Storage, etc.
# See .env.example in docker/ for cloud storage configuration

# ======================================
# CORS Configuration
# ======================================

# For production, specify your domain instead of *
WEB_API_CORS_ALLOW_ORIGINS=https://your-domain.com
CONSOLE_CORS_ALLOW_ORIGINS=https://your-domain.com

# ======================================
# SSL/TLS Configuration
# ======================================

# Let's Encrypt email for SSL certificate
CERTBOT_EMAIL=admin@your-domain.com

# Enable automatic SSL certificate generation
ENABLE_CERTBOT=true

# ======================================
# Monitoring (Optional)
# ======================================

# OpenTelemetry Configuration
ENABLE_OTEL=false
# OTLP_BASE_ENDPOINT=http://your-otel-collector:4318

# ======================================
# Email Configuration (Optional)
# ======================================

# SMTP settings for email notifications
# MAIL_TYPE=smtp
# SMTP_SERVER=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# SMTP_USE_TLS=true
# MAIL_DEFAULT_SEND_FROM=noreply@your-domain.com

# ======================================
# Advanced Configuration
# ======================================

# API rate limiting
APP_MAX_ACTIVE_REQUESTS=0
APP_MAX_EXECUTION_TIME=1200

# File access timeout (seconds)
FILES_ACCESS_TIMEOUT=300

# Access token expiration (minutes)
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=30

# ======================================
# Feature Flags
# ======================================

ENABLE_WEBSITE_JINAREADER=true
ENABLE_WEBSITE_FIRECRAWL=true
ENABLE_WEBSITE_WATERCRAWL=true

# ======================================
# Notes
# ======================================
#
# 1. Generate secure random keys:
#    openssl rand -hex 32
#
# 2. Update CELERY_BROKER_URL with the same REDIS_PASSWORD
#
# 3. For production, configure cloud storage instead of local storage
#
# 4. Set appropriate CORS origins to your domain
#
# 5. Ensure DB_PASSWORD and REDIS_PASSWORD match the values used in docker-compose
#
